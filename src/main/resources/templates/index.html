<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh">
<head>
    <title>Bucket Information</title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/layui/2.6.0/css/layui.css">
    <style>
        /* 基本页面样式 */
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }

        .container {
            background-color: #fff;
            border-radius: 8px;
            margin: 20px auto;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 90%;
        }

        /* 页面标题样式 */
        h1 {
            font-size: 24px;
            color: #333;
            margin-bottom: 20px;
        }

        /* 左侧导航栏样式 */
        .sidebar {
            width: 200px;
            background-color: #333;
            color: #fff;
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            overflow-y: auto;
        }

        .menu {
            padding: 20px;
        }

        .menu a {
            color: #fff;
            text-decoration: none;
            display: block;
            margin-bottom: 10px;
        }

        .menu a:hover {
            background-color: #007BFF;
        }
    </style>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }

        .container {
            background-color: #fff;
            border-radius: 8px;
            margin: 20px auto;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 90%;
        }

        h1 {
            font-size: 24px;
            color: #333;
            margin-bottom: 20px;
        }

        .layui-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        .layui-table td {
            vertical-align: middle;
        }

        img {
            max-width: 100px;
            max-height: 100px;
            cursor: pointer;
        }

        img:hover {
            transform: scale(1.1);
            transition: transform 0.3s;
        }
        /* Using CSS styles to limit label text length and add ellipsis */
        .layui-form-label {
            white-space: nowrap;
            max-width: 700px;
        }

        /* 自定义"Add New"按钮样式 */
        #addButtonDiv {
            text-align: right;
            margin-bottom: 10px;
        }

        #addButton {
            display: inline-block;
            text-align: center;
            background-color: #007BFF;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.3s;
            line-height: 1; /* 设置行高使文本垂直居中 */
        }

        #addButton:hover {
            background-color: #007BFF;
            transform: scale(1.05);
        }

        /* 自定义删除按钮样式 */
        .delete-button {
            background-color: #FF0000;
            color: #fff;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .delete-button:hover {
            background-color: #CC0000;
        }

        /* 自定义弹出框样式 */
        .layui-layer {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }

        .layui-layer .layui-layer-title {
            background-color: #007BFF;
            color: #fff; /* 设置标题文本颜色为白色 */
            font-weight: bold;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            padding: 10px;
        }

        .layui-layer-content {
            padding: 20px;
        }

        /* 自定义文件上传按钮样式 */
        .custom-file-input {
            background-color: #007BFF;
            color: #fff;
            border: 2px solid #007BFF;
            border-radius: 5px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.3s;
            text-align: center;
            display: inline-block;
        }

        .custom-file-input:hover {
            background-color: #007BFF;
            transform: scale(1.05);
        }

        /* 隐藏默认文件上传按钮，但保留其功能 */
        input[type="file"] {
            display: none;
        }


        /* 添加自定义确认框样式 */
        .custom-confirm-box {
            background-color: #fff;
            border: 1px solid #fff;;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0);
            padding: 20px;
            text-align: center;
        }


        .custom-confirm-content {
            font-size: 16px;
            margin-bottom: 20px;
        }

        .custom-confirm-buttons {
            text-align: center;
        }

        .confirm-yes, .confirm-no {
            padding: 10px 20px;
            margin: 0 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .confirm-yes {
            background-color: #007BFF;
            color: #fff;
        }

        .confirm-no {
            background-color: #FF0000;
            color: #fff;
        }
    </style>
    <style>
        /* 侧边栏整体样式 */
        .sidebar {
            width: 250px;
            background-color: #333;
            color: #fff;
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Logo 样式 */
        .logo {
            padding: 20px 0;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            border-bottom: 2px solid #fff; /* 添加底部白色线条 */
        }

        /* 导航菜单样式 */
        .menu {
            list-style: none;
            padding: 0;
            width: 100%;
            text-align: center;
        }

        .menu-item {
            display: block;
            height: 40px;
            line-height: 40px;
            text-decoration: none;
            transition: background-color 0.3s, color 0.3s;
            color: #fff;
            font-weight: bold;
            font-size: 16px;
            margin: 10px 0;
            background-color: #333; /* 默认背景颜色 */
        }

        .menu-item:hover {
            background-color: #1244EF !important;
        }

        /* 将选择框样式与整体协调 */
        .layui-input-block select {
            font-family: Arial, sans-serif;
            color: rgba(51, 51, 51, 0.97);
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            width: 100%;
            margin-top: 10px;
        }

        .layui-form-item {
            margin-bottom: 0px;
            clear: both;
            *zoom: 1;
        }

        .layui-input-block {
            margin-left: 0px;
            min-height: 36px;
        }
        /* 在CSS中为图片预览添加样式 */
        #imagePreviewContainer {
            display: none; /* 初始状态下隐藏预览容器 */
            position: fixed;
            top: 50%; /* 垂直居中 */
            left: 50%; /* 水平居中 */
            transform: translate(-50%, -50%); /* 使容器水平垂直居中 */
            z-index: 9999; /* 确保在其他元素之上 */
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            max-width: 90%; /* 控制容器的最大宽度 */
            max-height: 90%; /* 控制容器的最大高度 */
            text-align: center;
        }

        #previewedImage {
            max-width: 100%; /* 图片宽度不超过容器宽度 */
            max-height: 100%; /* 图片高度不超过容器高度 */
        }
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

    </style>
</head>
<body>

<div class="sidebar">
    <div class="logo">
        Content Hub
    </div>
    <ul class="menu">
        <li><a href="#" id="bucketManagement" class="menu-item">Bucket Management</a></li>
        <li><a href="#" id="contentManagement" class="menu-item">Content Management</a></li>
    </ul>
</div>


<div class="container" style="margin-left: 200px;">

    <div class="container">
        <h1>Bucket Information</h1>

        <div class="layui-form" style="display: grid; grid-template-columns: 1fr 1fr auto;">
            <div class="layui-form-item" style="display: flex; align-items: center;">
                <label class="layui-form-label">Bucket Type</label>
                <div class="layui-input-block" style="width: 200px; margin-right: 10px;">
                    <select id="bucketType" name="bucketType" lay-filter="bucketTypeSelect">
                        <option value="">Select a bucket type</option>
                        <th:block th:each="type : ${types}">
                            <option th:text="${type}"></option>
                        </th:block>
                    </select>
                </div>
            </div>

            <div style="display: flex; align-items: center;">
                <input type="text" id="searchKeyword" placeholder="Search..." class="layui-input" style="width: 250px; margin-right: 10px;">
                <button id="searchButton" class="layui-btn layui-btn-normal">Search</button>
            </div>

            <div id="addButtonDiv" style="display: flex; align-items: center;">
                <button id="addButton" class="layui-btn layui-btn-primary sci-fi-button">Add New</button>
            </div>
        </div>




        <table class="layui-table">
            <thead>
            <tr>
                <th>Bucket Name</th>
                <th>Object Key</th>
                <th>Description</th>
                <th>Image</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody id="bucketDetails">
            <!-- Data will be inserted here -->
            </tbody>
        </table>
    </div>

    <!-- Add New dialog template -->
    <div style="display: none;" id="addTemplate">
        <input type="text" id="bucketName" placeholder="Bucket Name" class="layui-input sci-fi-input"
               style="margin: 10px 0;"> <!-- 为输入框添加自定义类sci-fi-input -->
        <!--        <input type="text" id="bucketTypeSource" placeholder="Bucket Type" class="layui-input sci-fi-input"-->
        <!--               style="margin: 10px 0;"> &lt;!&ndash; 为输入框添加自定义类sci-fi-input &ndash;&gt;-->

        <div class="layui-input-block" style="margin: 10px 0;">
            <select id="bucketTypeSource" name="bucketType" lay-filter="bucketTypeSelect">
                <option value="">Select a bucket type</option>
                <th:block th:each="type : ${types}">
                    <option th:text="${type}"></option>
                </th:block>
            </select>
        </div>
        <!-- 文件上传按钮 -->
        <label for="fileInput" class="custom-file-input">Choose Files</label>
        <input type="file" id="fileInput" class="custom-file-input" multiple>
        <div class="file-name-display" id="fileNameDisplay"></div>

    </div>

    <!-- 图片预览-->
    <div id="imagePreviewContainer" style="display: none;">
        <img id="previewedImage" style="max-width: 100%; max-height: 100%; display: block; margin: 0 auto;">
    </div>
    <div id="overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 999;"></div>

    <!--上传loading-->
    <div id="loading" style="display: none;">
        <div class="loader"></div>
    </div>


</div>


<script src="https://cdn.bootcss.com/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/layui/2.6.0/layui.js"></script>
<!-- JavaScript代码 -->
<script>
    // 获取文件上传输入框
    var fileInput = document.getElementById("fileInput");

    // 获取用于显示文件名的元素
    var fileNameDisplay = document.getElementById("fileNameDisplay");

    fileInput.addEventListener("change", function () {
        // 显示已选择文件的名称
        fileNameDisplay.innerText = "Selected Files: " + Array.from(fileInput.files).map(function (file) {
            return file.name;
        }).join(", ");
    });


    // 获取搜索输入框和按钮
    var searchKeywordInput = document.getElementById("searchKeyword");
    var searchButton = document.getElementById("searchButton");

    // 监听按钮点击事件
    searchButton.addEventListener("click", function () {
        var searchKeyword = searchKeywordInput.value.trim().toLowerCase(); // 获取输入的查询关键字并转换为小写
        filterBucketDetails(searchKeyword);
    });

    // 筛选Bucket信息并显示结果
    function filterBucketDetails(keyword) {
        var rows = document.querySelectorAll("#bucketDetails tr"); // 获取所有Bucket信息行
        rows.forEach(function (row) {
            var cells = row.getElementsByTagName("td");
            var matched = false; // 用于标记是否匹配查询关键字

            // 检查每列中的文本是否包含查询关键字
            for (var i = 0; i < cells.length; i++) {
                var cellText = cells[i].textContent.trim().toLowerCase();
                if (cellText.includes(keyword)) {
                    matched = true;
                    break;
                }
            }

            // 显示或隐藏行
            if (matched) {
                row.style.display = ""; // 匹配，显示行
            } else {
                row.style.display = "none"; // 不匹配，隐藏行
            }
        });
    }

</script>
<script>
    layui.use(['form', 'jquery', 'layer'], function () {
        var form = layui.form;
        var $ = layui.$;
        var layer = layui.layer;

        // Get bucket types
        $.ajax({
            url: '/content/hub/api/db/bu/info',
            type: 'GET',
            success: function (data) {
                var bucketTypes = data.data;
                var typeSelect = $('#bucketType');
                for (var i = 0; i < bucketTypes.length; i++) {
                    typeSelect.append('<option value="' + bucketTypes[i] + '">' + bucketTypes[i] + '</option>');
                }
                form.render('select');
            },
            error: function () {
                console.error('Error fetching bucket types.');
            }
        });

        $.ajax({
            url: '/content/hub/api/db/bu/info',
            type: 'GET',
            success: function (data) {
                var bucketTypes = data.data;
                var bucketTypeSource = $('#bucketTypeSource');
                for (var i = 0; i < bucketTypes.length; i++) {
                    bucketTypeSource.append('<option value="' + bucketTypes[i] + '">' + bucketTypes[i] + '</option>');
                }
                form.render('select');
            },
            error: function () {
                console.error('Error fetching bucket types.');
            }
        });

        // Listen for bucket type selection
        form.on('select(bucketTypeSelect)', function (data) {
            var selectedType = data.value;
            $.ajax({
                url: '/content/hub/api/db/bu/list?bucketType=' + selectedType,
                type: 'GET',
                success: function (data) {
                    displayBucketDetails(data.data);
                },
                error: function () {
                    console.error('Error fetching bucket details.');
                }
            });
        });

        // Display bucket details
        function displayBucketDetails(data) {
            var detailsHtml = '';
            for (var i = 0; i < data.length; i++) {
                detailsHtml += '<tr>';
                detailsHtml += '<td>' + data[i].bucketName + '</td>';
                detailsHtml += '<td>' + data[i].objectKey + '</td>';
                detailsHtml += '<td>' + data[i].description + '</td>';
                detailsHtml += '<td><img src="' + data[i].imageUrl + '" alt="Image" data-image-url="' + data[i].imageUrl + '"></td>';
                detailsHtml += '<td><button class="delete-button" data-id="' + data[i].id + '" data-bucket-type="' + data[i].bucketType + '" data-bucket-name="' + data[i].bucketName + '" data-object-key="' + data[i].objectKey + '">Delete</button></td>';
                detailsHtml += '</tr>';
            }
            $('#bucketDetails').html(detailsHtml);

            // Bind click event to show image preview
            $('img').on('click', function () {
                var imageUrl = $(this).data('image-url');
                previewImage(imageUrl);
            });

            // Bind click event to execute delete operation
            // 绑定点击事件以执行删除操作
            $('.delete-button').on('click', function () {
                var id = $(this).data('id');
                var bucketType = $(this).data('bucketType');
                var bucketName = $(this).data('bucketName');
                var objectKey = $(this).data('objectKey');
                var confirmBox = '<div class="custom-confirm-box">';
                confirmBox += '<div class="custom-confirm-title"></div>';
                confirmBox += '<div class="custom-confirm-content">Are you sure you want to delete this item?</div>';
                confirmBox += '<div class="custom-confirm-buttons">';
                confirmBox += '<button class="confirm-button confirm-yes">Yes</button>';
                confirmBox += '<button class="confirm-button confirm-no">No</button>';
                confirmBox += '</div>';
                confirmBox += '</div>';

                // 打开自定义确认框
                const index = layer.open({
                    type: 1,
                    title: false,
                    closeBtn: false,
                    area: 'auto',
                    shadeClose: true,
                    content: confirmBox
                });

                // 点击"Yes"按钮时执行删除操作
                $('.confirm-yes').on('click', function () {
                    deleteBucketItem(id, bucketType, bucketName, objectKey);
                    layer.close(index); // 关闭确认框
                });

                // 点击"No"按钮时关闭确认框
                $('.confirm-no').on('click', function () {
                    layer.close(index); // 关闭确认框
                });
            });

        }

        // Delete bucket item
        function deleteBucketItem(id, bucketType, bucketName, objectKey) {

            $.ajax({
                // url: '/content/hub/api/db/bu/del/' + id + '/' + encodedBucketType + '/' + encodedBucketName + '/' + encodedObjectKey,
                url: '/content/hub/api/db/bu/del?id=' + id + "&bucketType=" + bucketType + "&bucketName=" + bucketName + '&objectKey=' + objectKey,
                type: 'DELETE',
                success: function (result) {
                    if (result.code === 200) {
                        refreshData();
                    } else {
                        alert('Delete operation failed: ' + result.message);
                    }
                },
                error: function () {
                    console.error('Error deleting bucket item.');
                }
            });
        }


        // Open the dialog when the "Add New" button is clicked
        $('#addButton').on('click', function () {
            layer.open({
                type: 1,
                title: 'Add New Bucket',
                area: ['500px', '350px'],
                content: $('#addTemplate'),
                btn: ['Confirm', 'Cancel'],
                yes: function (index, layero) {
                    showLoading(); // 显示加载状态
                    var bucketName = $('#bucketName').val();
                    var bucketTypeSource = $('#bucketTypeSource').val();
                    var files = document.getElementById('fileInput').files;
                    if (!bucketName || !bucketTypeSource || files.length === 0) {
                        alert('Please fill in all fields and select at least one file.');
                    } else {
                        // Create a FormData object to send files and data
                        var formData = new FormData();
                        formData.append('bucketName', bucketName);
                        formData.append('bucketType', bucketTypeSource);
                        for (var i = 0; i < files.length; i++) {
                            formData.append('file', files[i]);
                        }

                        // Send the request to upload files
                        $.ajax({
                            url: '/content/hub/api/db/bu/upload',
                            type: 'POST',
                            data: formData,
                            processData: false,
                            contentType: false,
                            success: function (result) {
                                if (result.code === 200) {
                                    refreshData();
                                    layer.close(index); // Close the dialog on success
                                } else {
                                    alert('Upload failed: ' + result.message);
                                }
                            },
                            error: function () {
                                console.error('Error uploading files.');
                            }
                        });
                        hideLoading(); // 显示加载状态
                    }
                }
            });
        });

        // Refresh data function
        function refreshData() {
            var selectedType = $('#bucketType').val();
            $.ajax({
                url: '/content/hub/api/db/bu/list?bucketType=' + selectedType,
                type: 'GET',
                success: function (data) {
                    displayBucketDetails(data.data);
                },
                error: function () {
                    console.error('Error fetching bucket details.');
                }
            });
        }
    });
</script>
<script>
    // JavaScript代码

    // 初始状态，显示默认内容
    displayBucketManagementContent();

    // 点击"Bucket Management"时显示对应内容
    document.getElementById("bucketManagement").addEventListener("click", function () {
        displayBucketManagementContent();
    });

    // 点击"Content Management"时显示对应内容
    document.getElementById("contentManagement").addEventListener("click", function () {
        displayContentManagementContent();
    });

    // 显示 Bucket Management 内容的函数
    function displayBucketManagementContent() {
        // 隐藏 Content Management 相关内容
        $('.container').hide();  // 显示原有内容
        $('#addTemplate').hide();  // 隐藏添加新内容的表单
    }

    // 显示 Content Management 内容的函数
    function displayContentManagementContent() {
        // 隐藏 Bucket Management 相关内容
        $('.container').show();  // 隐藏原有内容
        $('#addTemplate').hide();  // 显示添加新内容的表单
    }

    // 显示图片预览
    function previewImage(imageUrl) {
        var imagePreviewContainer = document.getElementById("imagePreviewContainer");
        var previewedImage = document.getElementById("previewedImage");
        var overlay = document.getElementById("overlay");

        // 设置预览图片的 src 属性
        previewedImage.src = imageUrl;

        // 显示预览容器和覆盖层
        imagePreviewContainer.style.display = "block";
        overlay.style.display = "block";

        // 点击预览图片时关闭预览
        previewedImage.addEventListener("click", closePreview);

        // 点击覆盖层时关闭预览
        overlay.addEventListener("click", closePreview);
    }

    // 关闭图片预览
    function closePreview() {
        var imagePreviewContainer = document.getElementById("imagePreviewContainer");
        var overlay = document.getElementById("overlay");

        // 隐藏预览容器和覆盖层
        imagePreviewContainer.style.display = "none";
        overlay.style.display = "none";
    }
    // 在文件上传前显示loading元素
    function showLoading() {
        document.getElementById("loading").style.display = "block";
    }

    // 在文件上传完成后隐藏loading元素
    function hideLoading() {
        document.getElementById("loading").style.display = "none";
    }

</script>
</body>
</html>
